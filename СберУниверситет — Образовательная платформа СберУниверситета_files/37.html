<!DOCTYPE html>
<!-- saved from url=(0052)https://prog-center.pro/sber/task/37?runMode=autorun -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title></title>
	
	<link href="./style_web_14.css" rel="stylesheet">
</head>
<body marginwidth="0" marginheight="0">
	<div class="submit_box">
		<button id="submit">Запустить</button>
		<p>Код: <span id="code">Выполните задание для получения проверочного кода.</span></p>
	</div>
	<div class="trigger">
		<div class=""><h3>Task</h3></div>
		<div><h3>HTML</h3></div>
		<div class="active"><h3>CSS</h3></div>
		<div><h3>Result</h3></div>
		<div><h3>Tests</h3></div>
	</div>
	<div class="fields">
		<div class="field" style="z-index: 0;">
			<div class="task">
				<li>Поменяйте местами цвет заднего фона у тега <span class="code">p</span> и цвет текста.</li>
			</div>
		</div>
		<div class="field" style="z-index: 0;">
			<textarea id="html" onkeydown="if(event.keyCode===9){var v=this.value,s=this.selectionStart,e=this.selectionEnd;this.value=v.substring(0, s)+&#39;\t&#39;+v.substring(e);this.selectionStart=this.selectionEnd=s+1;return false;}"></textarea>
		</div>
		<div class="field" style="z-index: 1;">
			<textarea id="css" onkeydown="if(event.keyCode===9){var v=this.value,s=this.selectionStart,e=this.selectionEnd;this.value=v.substring(0, s)+&#39;\t&#39;+v.substring(e);this.selectionStart=this.selectionEnd=s+1;return false;}"></textarea>
		</div>
		<div class="field" style="z-index: 0;">
			<div id="forResult"><iframe src="./saved_resource.html"></iframe></div>
		</div>
		<div class="field" style="z-index: 0;">
			<ul id="testResult"><li class="neg">Цвет заднего фона у тега p</li><li class="neg">Цвет текста у тега p</li></ul>
		</div>
	</div>

	<script type="text/javascript">
		const task_id = 37;
		const strange_word = "SiQcq82qWdpU0Qykb3ew";
	</script>
	<script type="text/javascript">
		const triggers = document.querySelectorAll('.trigger div');
		const fieldArr = document.querySelectorAll('.field');
		triggers.forEach(elem=>elem.addEventListener('click', function(){
		    triggers.forEach(elem=>elem.classList.remove('active'));
		    fieldArr.forEach(elem=>elem.style.zIndex = 0);
		    this.classList.add('active');
		    const fieldIndex =  [...triggers].indexOf(this);
		    fieldArr[fieldIndex].style.zIndex = 1;
		  })
		)
		triggers[0].click();
		document.querySelector('#submit').click()
	</script>
	<script type="text/javascript">
		const regexpStyle = /^[^{@]+{[^}]+}/gm;
const html = document.querySelector('#html');
const css  = document.querySelector('#css');
let btn  = document.querySelector('#submit');


html.value = `
<html>
<head>
</head>
<body>
<p>
Солнечные батареи выгодно устанавливать уже сейчас. В течение срока службы они принесут вам выгоду, примерно в 10 раз превышающую их стоимость.
</p>
<p>
Инвестиции в солнечные батареи – разумное решение. Такие инвестиции аналогичны инвестициям в меры по энергоэффективности и по уменьшению теплопотерь вашего дома. Любой прибор, которые потребляет меньше энергии, сразу начинает приносить вам деньги за счет экономии энергии. Затраты на дополнительное утепление вашего дома начинают приносить вам сразу экономию на кондиционирование и отопление. В настоящее время многие уже знают, что инвестиции в меры энергоэффективности являются очень умной инвестицией. Мы постарались показать, что инвестиции в солнечные батареи аналогичны.
</p>
<p>
Не забывайте также, что кроме экономии от установки солнечных батарей, вы вносите вклад в борьбу с загрязнением окружающей среды и с глобальным потеплением. Это происходит за счет того, что вы уменьшаете потребление энергии от традиционных, экологически грязных, топливных электростанций.
</p>
<p>
Солнечные батареи повышают стоимость вашего дома. А в некоторых случаях повышают его привлекательность у покупателей, т.к. даже если повышение стоимости дома будет меньше ваших затрат на солнечную электростанцию на крыше вашего дома, то продать такой “продвинутый” дом будет легче.
</p>
</body>
</html>
`;

css.value = `
body {
  background-color: #6f9e80;
  margin: 0;
  font-family: sans-serif;
}

p{
  background-color: #34495e;
  color: #ecf0f1;
  padding: 10px;
  margin: 10px;
}
`

const cssHandler = (cssText, dom)=>{
	[...cssText.match(regexpStyle)].map(style=>{
		const selector = style.match(/^([^{@]+){/g)[0].replaceAll(/[\n{]/g, '');
		const styleProps = style.match(/{[^}]+}/g)[0].replaceAll(/[\n{}]/g, '');
		return [selector, styleProps]
	}).forEach(style=>{
		[...dom.querySelectorAll(style[0])].forEach(elem=>elem.style = elem.style.cssText+style[1]);
	})

}

const inputHandler = ()=>{
	const result = document.createElement('iframe');
	document.querySelector('#forResult').innerText = '';
	document.querySelector('#forResult').appendChild(result);
	const innerDom = result.contentDocument;

	const htmlValue = html.value;
	const cssValue = css.value;
	const styleTag = document.createElement('style');

	styleTag.type = 'text/css';
	if (styleTag.styleSheet){
	  styleTag.styleSheet.cssText = cssValue;
	} else {
	  styleTag.appendChild(document.createTextNode(cssValue));
	}
	innerDom.write('');
	innerDom.write(htmlValue);
	try{
		cssHandler(css.value, innerDom);
	}catch{}
	// innerDom.querySelector('head').appendChild(styleTag);
};


html.addEventListener('input', inputHandler);
css.addEventListener('input', inputHandler);
inputHandler();
	</script>
	<script type="text/javascript">
		const tests = [

	{
		"msg": "Цвет заднего фона у тега p",
		"tag": 'p',
		"class": undefined,
		"id": undefined,
		'styleList': {
			'background-color': 'rgb(236,240,241)'
		}
	},
	{
		"msg": "Цвет текста у тега p",
		"tag": 'p',
		"class": undefined,
		"id": undefined,
		'styleList': {
			'color': 'rgb(52,73,94)'
		}
	},

]

const testHandler = ()=>{
	const dom = document.querySelector('iframe').contentDocument;
	document.querySelector('#testResult').innerText = '';

	tests.forEach(elem=>{
		const answer = document.createElement('li');

		let selector = ''
		if (elem.tag) selector	 += elem.tag;
		if (elem.id) selector	 += `#${elem.id}`;
		if (elem.class) selector += `.${elem.class}`;
		let testResult = true;
		if (dom.querySelectorAll(selector).length === 0){
			testResult = false;	
		}else{
			dom.querySelectorAll(selector).forEach(selectorElem=>{
				if (elem.innerText){
					testResult &&= (selectorElem.innerText.trim() === elem.innerText);
				}
				try{
					Object.entries(elem.styleList).forEach(style=>{
					let value = selectorElem.style[style[0]];
					if (value.substring(0, 3) === 'rgb'){
						value = value.replaceAll(' ', '');
					}
					testResult &&= (value === style[1]);
				})} catch{};
			})
		}
		if (testResult){
			answer.classList.add('pos');
		}else{
			answer.classList.add('neg');
		}


		answer.innerText = elem.msg;
		document.querySelector('#testResult').appendChild(answer);
	})
}

btn.addEventListener('click', testHandler);
	</script>
	<script type="text/javascript">document.querySelector('#submit').click()</script>
	<script type="text/javascript" src="./calculate_code_obf.js.Без названия">
	</script>

</body></html>